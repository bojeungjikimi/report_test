<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒì—… í´ë¦­ìœ¨ ë° ê´‘ê³ ë¹„ ëŒ€ë¹„ ìˆ˜ìµë¥  ëŒ€ì‹œë³´ë“œ - ë³´ì¦ì§€í‚´ì´</title>
    <link rel="icon" type="image/png" href="images/logo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f8fafc;
            color: #1a202c;
            line-height: 1.6;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .dashboard-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .stat-title {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: #1e40af;
            margin-bottom: 0.25rem;
        }

        .stat-change {
            font-size: 0.8rem;
            color: #10b981;
        }

        .section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .popup-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .popup-card {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .popup-name {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .popup-metrics {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-weight: 700;
            color: #1e40af;
        }

        .metric-label {
            color: #6b7280;
            font-size: 0.8rem;
        }

        .conversion-events {
            max-height: 400px;
            overflow-y: auto;
        }

        .event-item {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .event-type {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 0.25rem;
        }

        .event-details {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .event-time {
            font-size: 0.8rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .no-data {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 2rem;
        }

        .loading {
            text-align: center;
            color: #6b7280;
            padding: 2rem;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">ğŸ“Š ì¶”ì  ë°ì´í„° ëŒ€ì‹œë³´ë“œ</h1>
            <p class="dashboard-subtitle">íŒì—… í´ë¦­ìœ¨ ë° ê´‘ê³ ë¹„ ëŒ€ë¹„ ìˆ˜ìµë¥  ë¶„ì„</p>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="refreshData()">ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
            <button class="btn btn-secondary" onclick="clearData()">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
            <button class="btn btn-success" onclick="exportData()">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn" style="background: #8b5cf6; color: white;" onclick="generateSampleData()">ğŸ§ª ìƒ˜í”Œ ë°ì´í„° ìƒì„±</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-title">ì´ ì„¸ì…˜ ìˆ˜</div>
                <div class="stat-value" id="totalSessions">0</div>
                <div class="stat-change">+0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">ì´ ì „í™˜ ìˆ˜</div>
                <div class="stat-value" id="totalConversions">0</div>
                <div class="stat-change">+0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">ì´ íŒì—… í´ë¦­</div>
                <div class="stat-value" id="totalPopupClicks">0</div>
                <div class="stat-change">+0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">ì´ ê´‘ê³  ìˆ˜ìµ</div>
                <div class="stat-value" id="totalAdRevenue">0ì›</div>
                <div class="stat-change">+0%</div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">ğŸ“ˆ íŒì—… í´ë¦­ìœ¨ ë¶„ì„</h2>
            <div class="popup-stats" id="popupStats">
                <div class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">ğŸ’° ê´‘ê³ ë¹„ ëŒ€ë¹„ ìˆ˜ìµë¥  ë¶„ì„</h2>
            <div class="popup-stats" id="adStats">
                <div class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">ğŸ¯ ìµœê·¼ ì „í™˜ ì´ë²¤íŠ¸</h2>
            <div class="conversion-events" id="conversionEvents">
                <div class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>
    </div>

    <script>
        // ì¶”ì  ë°ì´í„° ë¡œë“œ
        function loadTrackingData() {
            try {
                const data = JSON.parse(localStorage.getItem('tracking_data') || '{}');
                return data;
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                return {};
            }
        }

        // íŒì—… í´ë¦­ìœ¨ ê³„ì‚°
        function calculatePopupClickRate(popupId, clicks) {
            // clicksê°€ ë°°ì—´ì¸ì§€ í™•ì¸í•˜ê³ , ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ë¡œ ì²˜ë¦¬
            if (!Array.isArray(clicks)) {
                console.warn(`íŒì—… ${popupId}ì˜ í´ë¦­ ë°ì´í„°ê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:`, clicks);
                return {
                    popupId,
                    totalOpens: 0,
                    totalInteractions: 0,
                    clickRate: '0%'
                };
            }
            
            const opens = clicks.filter(click => click && click.action === 'open').length;
            const totalInteractions = clicks.length;
            const clickRate = opens > 0 ? (totalInteractions / opens * 100).toFixed(2) + '%' : '0%';
            
            return {
                popupId,
                totalOpens: opens,
                totalInteractions,
                clickRate
            };
        }

        // ê´‘ê³ ë¹„ ëŒ€ë¹„ ìˆ˜ìµë¥  ê³„ì‚°
        function calculateAdROI(adId, revenues, adCost = 10000) {
            // revenuesê°€ ë°°ì—´ì¸ì§€ í™•ì¸í•˜ê³ , ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ë¡œ ì²˜ë¦¬
            if (!Array.isArray(revenues)) {
                console.warn(`ê´‘ê³  ${adId}ì˜ ìˆ˜ìµ ë°ì´í„°ê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:`, revenues);
                return {
                    adId,
                    totalRevenue: 0,
                    adCost,
                    roi: 'N/A'
                };
            }
            
            const totalRevenue = revenues.reduce((sum, rev) => {
                return sum + (rev && typeof rev.revenue === 'number' ? rev.revenue : 0);
            }, 0);
            const roi = adCost > 0 ? ((totalRevenue - adCost) / adCost * 100).toFixed(2) + '%' : 'N/A';
            
            return {
                adId,
                totalRevenue,
                adCost,
                roi
            };
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            const data = loadTrackingData();
            
            // ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸
            const totalSessions = new Set();
            const totalConversions = Array.isArray(data.conversion) ? data.conversion : [];
            
            // íŒì—… í´ë¦­ ë°ì´í„° ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
            const popupClickData = data.popup_click || {};
            const totalPopupClicks = Object.values(popupClickData)
                .filter(clicks => Array.isArray(clicks))
                .flat();
            
            // ê´‘ê³  ìˆ˜ìµ ë°ì´í„° ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
            const adRevenueData = data.ad_revenue || {};
            const totalAdRevenue = Object.values(adRevenueData)
                .filter(revenues => Array.isArray(revenues))
                .flat()
                .reduce((sum, rev) => sum + (rev && typeof rev.revenue === 'number' ? rev.revenue : 0), 0);

            // ì„¸ì…˜ ìˆ˜ ê³„ì‚°
            totalPopupClicks.forEach(click => totalSessions.add(click.sessionId));
            totalConversions.forEach(conversion => totalSessions.add(conversion.sessionId));

            document.getElementById('totalSessions').textContent = totalSessions.size;
            document.getElementById('totalConversions').textContent = totalConversions.length;
            document.getElementById('totalPopupClicks').textContent = totalPopupClicks.length;
            document.getElementById('totalAdRevenue').textContent = totalAdRevenue.toLocaleString() + 'ì›';

            // íŒì—… í†µê³„ ì—…ë°ì´íŠ¸
            updatePopupStats(data.popup_click || {});
            
            // ê´‘ê³  í†µê³„ ì—…ë°ì´íŠ¸
            updateAdStats(data.ad_revenue || {});
            
            // ì „í™˜ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
            updateConversionEvents(totalConversions);
        }

        // íŒì—… í†µê³„ ì—…ë°ì´íŠ¸
        function updatePopupStats(popupClicks) {
            const container = document.getElementById('popupStats');
            
            if (Object.keys(popupClicks).length === 0) {
                container.innerHTML = '<div class="no-data">íŒì—… í´ë¦­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            const stats = Object.keys(popupClicks).map(popupId => {
                const clicks = popupClicks[popupId];
                const stats = calculatePopupClickRate(popupId, clicks);
                
                return `
                    <div class="popup-card">
                        <div class="popup-name">${popupId}</div>
                        <div class="popup-metrics">
                            <div class="metric">
                                <div class="metric-value">${stats.totalOpens}</div>
                                <div class="metric-label">ì—´ê¸°</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${stats.totalInteractions}</div>
                                <div class="metric-label">ìƒí˜¸ì‘ìš©</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${stats.clickRate}</div>
                                <div class="metric-label">í´ë¦­ìœ¨</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = stats;
        }

        // ê´‘ê³  í†µê³„ ì—…ë°ì´íŠ¸
        function updateAdStats(adRevenue) {
            const container = document.getElementById('adStats');
            
            if (Object.keys(adRevenue).length === 0) {
                container.innerHTML = '<div class="no-data">ê´‘ê³  ìˆ˜ìµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            const stats = Object.keys(adRevenue).map(adId => {
                const revenues = adRevenue[adId];
                const stats = calculateAdROI(adId, revenues);
                
                return `
                    <div class="popup-card">
                        <div class="popup-name">${adId}</div>
                        <div class="popup-metrics">
                            <div class="metric">
                                <div class="metric-value">${stats.totalRevenue.toLocaleString()}ì›</div>
                                <div class="metric-label">ì´ ìˆ˜ìµ</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${stats.adCost.toLocaleString()}ì›</div>
                                <div class="metric-label">ê´‘ê³ ë¹„</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${stats.roi}</div>
                                <div class="metric-label">ROI</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = stats;
        }

        // ì „í™˜ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateConversionEvents(conversions) {
            const container = document.getElementById('conversionEvents');
            
            if (conversions.length === 0) {
                container.innerHTML = '<div class="no-data">ì „í™˜ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // ìµœê·¼ 20ê°œ ì´ë²¤íŠ¸ë§Œ í‘œì‹œ
            const recentConversions = conversions.slice(-20).reverse();
            
            const events = recentConversions.map(conversion => {
                const time = new Date(conversion.timestamp).toLocaleString('ko-KR');
                
                return `
                    <div class="event-item">
                        <div class="event-type">${conversion.eventType}</div>
                        <div class="event-details">ê°’: ${conversion.eventValue}</div>
                        <div class="event-time">${time}</div>
                    </div>
                `;
            }).join('');

            container.innerHTML = events;
        }

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        function refreshData() {
            updateDashboard();
            alert('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° ìƒì„±
        function generateSampleData() {
            const sampleData = {
                popup_click: {
                    'hero_cta': [
                        {
                            sessionId: 'session_1234567890_abc123',
                            popupId: 'hero_cta',
                            popupType: 'cta_button',
                            action: 'open',
                            timestamp: new Date(Date.now() - 3600000).toISOString(),
                            userAgent: navigator.userAgent,
                            referrer: document.referrer,
                            url: window.location.href
                        },
                        {
                            sessionId: 'session_1234567890_abc123',
                            popupId: 'hero_cta',
                            popupType: 'cta_button',
                            action: 'interact',
                            timestamp: new Date(Date.now() - 3500000).toISOString(),
                            userAgent: navigator.userAgent,
                            referrer: document.referrer,
                            url: window.location.href
                        }
                    ],
                    'payment_modal': [
                        {
                            sessionId: 'session_1234567890_abc123',
                            popupId: 'payment_modal',
                            popupType: 'modal_popup',
                            action: 'open',
                            timestamp: new Date(Date.now() - 1800000).toISOString(),
                            userAgent: navigator.userAgent,
                            referrer: document.referrer,
                            url: window.location.href
                        }
                    ]
                },
                ad_revenue: {
                    'payment_conversion': [
                        {
                            sessionId: 'session_1234567890_abc123',
                            adId: 'payment_conversion',
                            adType: 'conversion',
                            revenue: 6900,
                            currency: 'KRW',
                            timestamp: new Date(Date.now() - 900000).toISOString(),
                            userAgent: navigator.userAgent,
                            referrer: document.referrer,
                            url: window.location.href
                        }
                    ]
                },
                conversion: [
                    {
                        sessionId: 'session_1234567890_abc123',
                        eventType: 'form_submitted',
                        eventValue: 'payment_modal',
                        metadata: {
                            propertyType: 'ì•„íŒŒíŠ¸',
                            depositAmount: 100000000
                        },
                        timestamp: new Date(Date.now() - 1800000).toISOString(),
                        userAgent: navigator.userAgent,
                        referrer: document.referrer,
                        url: window.location.href
                    },
                    {
                        sessionId: 'session_1234567890_abc123',
                        eventType: 'payment_completed',
                        eventValue: 6900,
                        metadata: {
                            propertyType: 'ì•„íŒŒíŠ¸',
                            residenceStatus: 'ê±°ì£¼ì',
                            amount: 6900
                        },
                        timestamp: new Date(Date.now() - 900000).toISOString(),
                        userAgent: navigator.userAgent,
                        referrer: document.referrer,
                        url: window.location.href
                    }
                ]
            };
            
            localStorage.setItem('tracking_data', JSON.stringify(sampleData));
            updateDashboard();
            alert('ìƒ˜í”Œ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ë°ì´í„° ì´ˆê¸°í™”
        function clearData() {
            if (confirm('ëª¨ë“  ì¶”ì  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('tracking_data');
                updateDashboard();
                alert('ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const data = loadTrackingData();
            const exportData = {
                ...data,
                exportDate: new Date().toISOString(),
                summary: {
                    totalSessions: document.getElementById('totalSessions').textContent,
                    totalConversions: document.getElementById('totalConversions').textContent,
                    totalPopupClicks: document.getElementById('totalPopupClicks').textContent,
                    totalAdRevenue: document.getElementById('totalAdRevenue').textContent
                }
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tracking_dashboard_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            
            // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            setInterval(updateDashboard, 30000);
        });
    </script>
</body>
</html>
