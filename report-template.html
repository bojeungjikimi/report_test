<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부동산 안전성 검증 보고서 - 보증지킴이</title>
    <link rel="stylesheet" href="css/report-styles.css">
</head>
<body>
    <div class="report-container">
        <!-- 헤더 -->
        <div class="report-header">
            <div class="header-content">
                <img src="images/logo.png" alt="보증지킴이" class="header-logo">
                <h3 class="company-name">보증지킴이</h3>
            </div>
        </div>


        <!-- 고객 개인화 정보 -->
        <div class="customer-info-section section-content active" id="customer-section">
            <div class="customer-header">
                <h2 class="customer-title"><span class="customer-name">김철수님</span>을 위한 맞춤 리포트</h2>
                <p class="customer-subtitle">안전한 전/월세 계약을 위한 전문 분석 결과입니다</p>
            </div>
            
            <div class="customer-details">
                <div class="detail-item">
                    <span class="detail-label">요청하신 분석</span>
                    <span class="detail-value" id="requestedAnalysis">집주인 재정상태 + 법적 위험성</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">계약 상황</span>
                    <span class="detail-value" id="contractSituation">계약은 했는데 아직 이사 전이에요</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">추가사항</span>
                    <span class="detail-value" id="additionalInfo">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">계약 예정기간</span>
                    <span class="detail-value" id="contractPeriod">2년</span>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="report-content">
            <!-- 기본 정보 섹션 -->
            <div class="section-content active" id="basic-section">

                <!-- 분석 조건 정보 -->
                <div class="property-info-table">
                    <div class="table-header">분석한 집 정보</div>
                    <table class="info-table">
                        <tbody>
                            <tr>
                                <td class="info-label">주소</td>
                                <td class="info-value" id="propertyAddress" colspan="3">서울시 강남구 역삼동 123-45</td>
                            </tr>
                            <tr>
                                <td class="info-label">보증금 유형</td>
                                <td class="info-value" id="depositType">전세</td>
                                <td class="info-label">상세유형</td>
                                <td class="info-value" id="detailType">일반임대</td>
                            </tr>
                            <tr>
                                <td class="info-label">보증금</td>
                                <td class="info-value" id="depositAmount">3억원</td>
                                <td class="info-label">월세</td>
                                <td class="info-value" id="monthlyRent">-</td>
                            </tr>
                            <tr>
                                <td class="info-label">상황</td>
                                <td class="info-value" id="residenceStatus" colspan="3">가계약금 지급 완료</td>
                            </tr>
                        </tbody>
                    </table>
                </div>



                <!-- 종합 분석 결과 -->
                <div class="score-analysis">
                    <h3 class="analysis-title">종합 안전성 분석</h3>
                    
                    <!-- 점수 시각화 -->
                    <div class="score-visualization">
                        <div class="score-circle">
                            <div class="score-number" id="overallScore">85</div>
                </div>
                </div>
                    
                    <!-- 점수 범위 표시 -->
                    <div class="score-range">
                        <div class="range-bar">
                            <div class="range-fill"></div>
                            <div class="range-marker" style="left: 85%;"></div>
                </div>
                        <div class="range-labels">
                            <span>위험 (0-30)</span>
                            <span>주의 (31-60)</span>
                            <span>보통 (61-80)</span>
                            <span>안전 (81-100)</span>
            </div>
        </div>

                    <!-- 점수 상태 -->
                    <div class="score-status">
                        <div class="status-badge safe" id="overallStatus">양호</div>
                        <p class="status-desc" id="overallDescription">전반적으로 안전한 거래 가능</p>
                    </div>

                    <!-- 세부 분석 그리드 -->
                    <div class="analysis-grid">
                        <div class="analysis-item legal">
                            <div class="analysis-header">
                                <div class="analysis-icon">⚖️</div>
                                <div class="analysis-category">법적 안전성</div>
                            </div>
                            <div class="analysis-content">
                                <div class="analysis-score" id="legalScore">90점</div>
                                <div class="analysis-description">등기부등본 정상</div>
                            </div>
                        </div>
                        <div class="analysis-item financial">
                            <div class="analysis-header">
                                <div class="analysis-icon">💰</div>
                                <div class="analysis-category">금융 안전성</div>
                            </div>
                            <div class="analysis-content">
                                <div class="analysis-score" id="financialScore">85점</div>
                                <div class="analysis-description">대출 승인 가능</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- 안전 진단 섹션 -->
            <div class="section-content" id="safety-section">
                <!-- 최종 검토 결과 타이틀 -->
                <div class="final-review-title">
                    <div class="title-content">
                        <h2 class="title-text">꼼꼼하게 확인했어요!</h2>
                        <p class="title-subtitle">문제없음 - 안전한 거래 가능</p>
                    </div>
                </div>

                <!-- 등기부등본 관련 정보 카드 -->
                <div class="status-card safe">
                    <div class="status-header">
                        <div class="status-icon safe">📋</div>
                        <div>
                            <h3 class="status-title">등기부등본</h3>
                            <p class="status-description">소유권 및 권리 관계 확인</p>
                        </div>
                    </div>
                    <div class="verification-grid">
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">소유권 이전</div>
                                <div class="verification-status no-risk">문제없음</div>
                        </div>
                    </div>
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">근저당권</div>
                                <div class="verification-status no-risk">문제없음</div>
                        </div>
                    </div>
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">전세권</div>
                                <div class="verification-status no-risk">문제없음</div>
                            </div>
                        </div>
                    </div>
            </div>

                <!-- 건축물대장 정보 카드 -->
                <div class="status-card safe">
                    <div class="status-header">
                        <div class="status-icon safe">🏠</div>
                        <div>
                            <h3 class="status-title">건축물대장</h3>
                            <p class="status-description">건물 상태 및 용도 확인</p>
                        </div>
                    </div>
                    <div class="verification-grid">
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">건물 정보</div>
                                <div class="verification-status no-risk">정상</div>
                        </div>
                    </div>
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">용도 위반</div>
                                <div class="verification-status no-risk">없음</div>
                        </div>
                    </div>
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">불법 증축</div>
                                <div class="verification-status no-risk">없음</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 토지대장 정보 카드 -->
                <div class="status-card safe">
                    <div class="status-header">
                        <div class="status-icon safe">🌍</div>
                        <div>
                            <h3 class="status-title">토지대장</h3>
                            <p class="status-description">토지 상태 및 면적 확인</p>
                        </div>
                    </div>
                    <div class="verification-grid">
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">토지 정보</div>
                                <div class="verification-status no-risk">정상</div>
                            </div>
                        </div>
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">지목 변경</div>
                                <div class="verification-status no-risk">없음</div>
                            </div>
                        </div>
                        <div class="verification-item no-risk">
                            <div class="verification-icon no-risk">OK</div>
                            <div class="verification-content">
                                <div class="verification-name">면적 확인</div>
                                <div class="verification-status no-risk">일치</div>
                            </div>
                        </div>
                    </div>
            </div>

            </div>

            <!-- 보증보험 및 임대대출 섹션 -->
            <div class="section-content" id="insurance-section">
                <!-- 보험 가입 가능성 상태 카드 -->
                <div class="status-card safe">
                    <div class="status-header">
                        <div class="status-icon safe">🛡️</div>
                        <div>
                            <h3 class="status-title">보험 가입</h3>
                            <p class="status-description">안전하게 보호받을 수 있어요</p>
                        </div>
                    </div>
                </div>

                <!-- 보험 및 대출 정보 -->
                <!-- 보증보험 정보 -->
                <div class="insurance-loan-section">
                    <div class="section-header">
                        <div class="section-icon">🛡️</div>
                        <h4 class="section-title">임대차보증금 반환보증보험</h4>
                        </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">가입 가능 여부</div>
                            <div class="info-value success">가입 가능</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">월 보험료</div>
                            <div class="info-value">3만원</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">보장 한도</div>
                            <div class="info-value">최대 3억원</div>
                    </div>
                        <div class="info-item">
                            <div class="info-label">추천 보험사</div>
                            <div class="info-value">DB손해보험, 현대해상</div>
                </div>
                    </div>
                </div>

                <!-- 전세대출 정보 -->
                <div class="insurance-loan-section">
                    <div class="section-header">
                        <div class="section-icon">💰</div>
                        <h4 class="section-title">전세대출</h4>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">대출 가능 여부</div>
                            <div class="info-value success">대출 가능</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">대출 한도</div>
                            <div class="info-value">2.4억원</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">대출 비율</div>
                            <div class="info-value">보증금의 80%</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">추천 은행</div>
                            <div class="info-value">국민은행, 신한은행</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 시나리오 섹션 -->
            <div class="section-content" id="scenario-section">
                <!-- 경매 시나리오 -->
                <div class="status-card danger" id="scenario-auction-card" style="display: none;">
                    <div class="status-header-with-button">
                        <div class="status-info">
                            <div class="status-icon danger">경매</div>
                        <div>
                                <h3 class="status-title">경매 상황</h3>
                                <p class="status-description">경매 발생 시 예상되는 상황과 손실 분석</p>
                        </div>
                        </div>
                        <button class="detail-button" onclick="toggleDetailFooter('auction')">상세보기</button>
                    </div>
                </div>

                <!-- 전세사기 유형별 분석 -->
                <div class="status-card warning" id="scenario-fraud-card" style="display: none;">
                    <div class="status-header-with-button">
                        <div class="status-info">
                            <div class="status-icon warning">💡</div>
                        <div>
                                <h3 class="status-title">전세사기</h3>
                                <p class="status-description">이런 전세사기들이 있어요</p>
                        </div>
                        </div>
                        <button class="detail-button" onclick="toggleDetailFooter('fraud')">상세보기</button>
                    </div>
                </div>

                <!-- 현재 상황 시나리오들 -->
                <div class="status-card safe" id="scenario-contact-card" style="display: none;">
                    <div class="status-header-with-button">
                        <div class="status-info">
                            <div class="status-icon safe">📞</div>
                            <div>
                                <h3 class="status-title">집주인 연락 두절</h3>
                                <p class="status-description">갑자기 연락이 안 될 때</p>
                        </div>
                        </div>
                        <button class="detail-button" onclick="toggleDetailFooter('contact')">상세보기</button>
                    </div>
                </div>

                <div class="status-card warning" id="scenario-price-card" style="display: none;">
                    <div class="status-header-with-button">
                        <div class="status-info">
                            <div class="status-icon warning">💡</div>
                        <div>
                                <h3 class="status-title">저렴한 매물</h3>
                                <p class="status-description">너무 싸게 나온 집일 때</p>
                        </div>
                    </div>
                        <button class="detail-button" onclick="toggleDetailFooter('price')">상세보기</button>
                    </div>
                </div>

                <div class="status-card danger" id="scenario-contract-card" style="display: none;">
                    <div class="status-header-with-button">
                        <div class="status-info">
                            <div class="status-icon danger">상황</div>
                            <div>
                                <h3 class="status-title">계약서 이상 조항</h3>
                                <p class="status-description">이상한 조건이 있을 때</p>
                            </div>
                        </div>
                        <button class="detail-button" onclick="toggleDetailFooter('contract')">상세보기</button>
                    </div>
                </div>

                <div class="status-card safe" id="scenario-credit-card" style="display: none;">
                    <div class="status-header-with-button">
                        <div class="status-info">
                            <div class="status-icon safe">💳</div>
                            <div>
                                <h3 class="status-title">집주인 신용도</h3>
                                <p class="status-description">집주인 재정상태가 불안할 때</p>
                            </div>
                        </div>
                        <button class="detail-button" onclick="toggleDetailFooter('credit')">상세보기</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 푸터 -->
        <div class="report-footer">
            <div class="footer-logo">보증지킴이</div>
            <div class="footer-info">
                안전한 부동산 거래를 위한 전문 서비스<br>
                이메일: bojangjikimi@gmail.com
            </div>
        </div>
    </div>

    <!-- 상세 정보 푸터박스 -->
    <div class="detail-footer" id="detail-footer">
        <div class="detail-header">
            <h3 class="detail-title" id="detail-title">경매 상세 정보</h3>
            <button class="close-button" onclick="closeDetailFooter()">×</button>
        </div>
        <div class="detail-content" id="detail-content">
            <!-- 경매 상세 정보가 여기에 동적으로 로드됩니다 -->
        </div>
    </div>

    <!-- 하단 고정 CTA 버튼 바 -->
    <div class="bottom-cta-bar">
        <div class="cta-buttons">
            <button class="cta-button active" onclick="showSection('basic')">기본정보</button>
            <button class="cta-button" onclick="showSection('safety')">안전진단</button>
            <button class="cta-button" onclick="showSection('insurance')">보험대출</button>
            <button class="cta-button" onclick="showSection('scenario')">시나리오</button>
        </div>
    </div>

    <script>
        /**
         * ========================================
         * 부동산 안전성 검증 보고서 데이터 설정 함수
         * ========================================
         * 
         * 이 함수는 보고서에 표시될 모든 데이터를 설정하고, 
         * 동시에 브라우저의 localStorage에 저장하여 다음에 페이지를 열 때도 
         * 동일한 데이터가 자동으로 로드되도록 합니다.
         * 
         * 사용법:
         * setReportData({
         *     customerName: "홍길동",
         *     propertyAddress: "서울시 강남구 테헤란로 123",
         *     depositAmount: "2억원",
         *     totalScore: 88
         * });
         * 
         * @param {Object} data - 보고서에 표시할 데이터 객체
         * @param {string} data.customerName - 고객 이름 (예: "김철수")
         * @param {string} data.requestedAnalysis - 요청한 분석 유형 (예: "집주인 재정상태 + 법적 위험성")
         * @param {string} data.contractSituation - 계약 상황 (예: "계약은 했는데 아직 이사 전이에요")
         * @param {string} data.additionalInfo - 거주 상태/추가 정보 (예: "계약하고 싶은 집이 있어요")
         * @param {string} data.contractPeriod - 계약 기간 (예: "2년")
         * @param {string} data.propertyAddress - 부동산 주소 (예: "서울시 강남구 역삼동 123-45")
         * @param {string} data.depositType - 보증금 유형 (예: "전세", "월세", "반전세")
         * @param {string} data.detailType - 상세 유형 (예: "일반임대", "전세대출")
         * @param {string} data.depositAmount - 보증금 금액 (예: "3억원", "1억 5천만원")
         * @param {string} data.monthlyRent - 월세 금액 (월세/반전세인 경우, 예: "50만원", "-")
         * @param {string} data.detailStatus - 상세 상태 (예: "가계약금만 지급한 상황이예요")
         * @param {number} data.totalScore - 종합 점수 (0-100 사이의 숫자, 예: 85)
         * @param {string} data.scoreLabel - 점수 라벨 (예: "양호", "우수", "주의", "위험")
         * @param {string} data.scoreDescription - 점수 설명 (예: "전반적으로 안전한 거래가 가능한 수준입니다")
         * @param {number} data.legalScore - 법적 안전성 점수 (0-100, 예: 90)
         * @param {number} data.financialScore - 금융 안전성 점수 (0-100, 예: 85)
         * @param {Array<string>} data.cautions - 주의사항 배열 (예: ["건물 노후도가 높습니다", "교통 혼잡 예상"])
         * @param {Array<string>} data.improvements - 개선 제안 배열 (예: ["등기부등본 확인하세요", "보험 가입 권장"])
         * @param {string} data.conclusion - 결론 (선택사항)
         */
        function setReportData(data) {
            try {
                // 기본 데이터 설정 (모든 필수 필드에 대한 기본값 제공)
            const defaultData = {
                customerName: '김철수',
                requestedAnalysis: '집주인 재정상태 + 법적 위험성',
                contractSituation: '계약은 했는데 아직 이사 전이에요',
                additionalInfo: '계약하고 싶은 집이 있어요',
                contractPeriod: '2년',
                propertyAddress: '서울시 강남구 역삼동 123-45',
                    depositType: '전세',
                    detailType: '일반임대',
                depositAmount: '3억원',
                    monthlyRent: '-',
                detailStatus: '가계약금만 지급한 상황이예요',
                totalScore: 85,
                scoreLabel: '양호',
                scoreDescription: '해당 부동산은 전반적으로 안전한 거래가 가능한 수준입니다. 일부 주의사항이 있으나 큰 문제는 없습니다.',
                legalScore: 90,
                financialScore: 85,
                scenarioAuction: true,
                scenarioFraud: true,
                scenarioContact: true,
                scenarioPrice: true,
                scenarioContract: true,
                scenarioCredit: true,
                cautions: [
                    '건물 노후도가 높아 리모델링이 필요할 수 있습니다.',
                    '주변 상업시설 증가로 교통 혼잡이 예상됩니다.',
                    '관리비 인상 가능성을 고려해야 합니다.'
                ],
                improvements: [
                    '계약 전 부동산 등기부등본을 반드시 확인하세요.',
                    '보증금 지급 전 중도금 계약을 체결하는 것을 권장합니다.',
                    '임대차보증금 반환보증보험 가입을 검토해보세요.'
                ],
                conclusion: '본 부동산은 전반적으로 안전한 거래가 가능한 수준으로 평가됩니다. 법적 안전성과 금융 안전성이 우수하며, 지역적 접근성도 양호합니다. 다만 건물 노후도와 관련된 주의사항을 고려하여 신중한 의사결정을 하시기 바랍니다. 보증지킴이는 지속적으로 부동산 시장의 변화를 모니터링하여 더욱 정확한 정보를 제공하겠습니다.'
            };

                // 전달받은 데이터와 기본 데이터 병합 (전달받은 데이터가 우선)
            const reportData = { ...defaultData, ...data };

                // ========================================
                // 1. HTML 요소에 데이터 적용 (화면 업데이트)
                // ========================================

            // 고객 정보 업데이트
                const customerTitle = document.querySelector('.customer-title');
                if (customerTitle) {
                    customerTitle.innerHTML = `<span class="customer-name">${reportData.customerName}님</span>을 위한 맞춤 리포트`;
                }

                // 고객 상세 정보 업데이트
                updateElementById('requestedAnalysis', reportData.requestedAnalysis);
                updateElementById('contractSituation', reportData.contractSituation);
                updateElementById('additionalInfo', reportData.additionalInfo || '-');
                updateElementById('contractPeriod', reportData.contractPeriod);

                // 부동산 정보 업데이트
                updateElementById('propertyAddress', reportData.propertyAddress);
                updateElementById('depositType', reportData.depositType);
                updateElementById('detailType', reportData.detailType);
                updateElementById('depositAmount', reportData.depositAmount);
                updateElementById('monthlyRent', reportData.monthlyRent || '-');
                updateElementById('residenceStatus', reportData.additionalInfo);

                // 점수 정보 업데이트
                // 법적 안전성과 금융 안전성 점수의 평균으로 종합 점수 계산
                const averageScore = Math.round(((reportData.legalScore + reportData.financialScore) / 2) * 10) / 10;
                updateElementById('overallScore', averageScore);
                updateElementById('overallStatus', reportData.scoreLabel);
                updateElementById('overallDescription', reportData.scoreDescription);
                updateElementById('legalScore', reportData.legalScore + '점');
                updateElementById('financialScore', reportData.financialScore + '점');

                // 점수에 따른 색상 및 스타일 조정
                updateScoreColors(averageScore);
                updateAnalysisScoreColors();

                // 시나리오 카드 표시/숨김 처리
                updateScenarioVisibility(reportData);

                // ========================================
                // 2. localStorage에 데이터 저장 (영구 저장)
                // ========================================
                localStorage.setItem('reportData', JSON.stringify(reportData));
                
                // 성공 메시지 (개발자용)
                console.log('✅ 보고서 데이터가 성공적으로 업데이트되고 저장되었습니다.');
                console.log('📊 저장된 데이터:', reportData);

            } catch (error) {
                // 오류 발생 시 사용자에게 알림
                console.error('❌ 보고서 데이터 설정 중 오류가 발생했습니다:', error);
                alert('보고서 데이터를 설정하는 중 오류가 발생했습니다. 페이지를 새로고침하고 다시 시도해주세요.');
            }
        }

        /**
         * ========================================
         * HTML 요소 업데이트 헬퍼 함수
         * ========================================
         * 
         * 특정 ID를 가진 HTML 요소의 텍스트 내용을 안전하게 업데이트합니다.
         * 요소가 존재하지 않아도 오류가 발생하지 않도록 처리합니다.
         * 
         * @param {string} elementId - 업데이트할 HTML 요소의 ID
         * @param {string|number} value - 설정할 값
         */
        function updateElementById(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
            } else {
                console.warn(`⚠️ ID가 '${elementId}'인 요소를 찾을 수 없습니다.`);
            }
        }

        /**
         * ========================================
         * localStorage에서 데이터 불러오기 함수
         * ========================================
         * 
         * 브라우저의 localStorage에서 이전에 저장된 보고서 데이터를 안전하게 불러옵니다.
         * 데이터가 없거나 손상된 경우 기본값을 사용합니다.
         * 
         * @returns {Object} 불러온 데이터 또는 기본 데이터
         */
        function loadReportDataFromStorage() {
            try {
                const savedData = localStorage.getItem('reportData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    console.log('📂 저장된 보고서 데이터를 불러왔습니다:', parsedData);
                    return parsedData;
                } else {
                    console.log('📂 저장된 데이터가 없습니다. 기본 데이터를 사용합니다.');
                    return {};
                }
            } catch (error) {
                console.error('❌ 저장된 데이터를 불러오는 중 오류가 발생했습니다:', error);
                console.log('📂 기본 데이터를 사용합니다.');
                return {};
            }
        }

        // 점수에 따른 색상 업데이트
        function updateScoreColors(score) {
            const rangeMarker = document.querySelector('.range-marker');
            const statusBadge = document.getElementById('overallStatus');
            const scoreCircle = document.querySelector('.score-circle');
            
            // range-marker 위치 업데이트
            if (rangeMarker) {
                rangeMarker.style.left = score + '%';
            }
            
            // score-circle 색상 업데이트 (range-labels 색상과 동일)
            if (scoreCircle) {
                if (score >= 81) {
                    // 안전 (81-100): #10b981
                    scoreCircle.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                } else if (score >= 61) {
                    // 보통 (61-80): #eab308
                    scoreCircle.style.background = 'linear-gradient(135deg, #eab308 0%, #ca8a04 100%)';
                } else if (score >= 31) {
                    // 주의 (31-60): #f59e0b
                    scoreCircle.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                } else {
                    // 위험 (0-30): #dc2626
                    scoreCircle.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
                }
            }
            
            // status-badge 클래스 및 텍스트 업데이트 (range-labels 색상과 동일)
            if (statusBadge) {
                // 기존 클래스 제거
                statusBadge.classList.remove('safe', 'warning', 'danger');
                
                if (score >= 81) {
                    // 안전 (81-100): #10b981
                    statusBadge.classList.add('safe');
                    statusBadge.textContent = '안전';
                } else if (score >= 61) {
                    // 보통 (61-80): #eab308
                    statusBadge.classList.add('warning');
                    statusBadge.textContent = '보통';
                } else if (score >= 31) {
                    // 주의 (31-60): #f59e0b
                    statusBadge.classList.add('warning');
                    statusBadge.textContent = '주의';
                } else {
                    // 위험 (0-30): #dc2626
                    statusBadge.classList.add('danger');
                    statusBadge.textContent = '위험';
                }
            }
        }

        // 개별 점수에 따른 색상 업데이트
        function updateAnalysisScoreColors() {
            const analysisScores = document.querySelectorAll('.analysis-score');
            
            analysisScores.forEach(scoreElement => {
                const scoreText = scoreElement.textContent;
                const score = parseInt(scoreText.replace('점', ''));
                
                if (!isNaN(score)) {
                    // 기존 클래스 제거
                    scoreElement.classList.remove('score-safe', 'score-warning', 'score-danger');
                    
                    if (score >= 80) {
                        // 안전 (80-100): #10b981
                        scoreElement.classList.add('score-safe');
                    } else if (score >= 60) {
                        // 보통 (60-79): #eab308
                        scoreElement.classList.add('score-warning');
                    } else {
                        // 위험 (0-59): #dc2626
                        scoreElement.classList.add('score-danger');
                    }
                }
            });
        }

        // 시나리오 카드 표시/숨김 처리
        function updateScenarioVisibility(reportData) {
            const scenarioCards = {
                'scenarioAuction': 'scenario-auction-card',
                'scenarioFraud': 'scenario-fraud-card',
                'scenarioContact': 'scenario-contact-card',
                'scenarioPrice': 'scenario-price-card',
                'scenarioContract': 'scenario-contract-card',
                'scenarioCredit': 'scenario-credit-card'
            };

            Object.keys(scenarioCards).forEach(scenarioKey => {
                const cardElement = document.getElementById(scenarioCards[scenarioKey]);
                if (cardElement) {
                    if (reportData[scenarioKey]) {
                        cardElement.style.display = 'block';
                    } else {
                        cardElement.style.display = 'none';
                    }
                }
            });
        }


        // 섹션 전환 함수
        function showSection(sectionId) {
            // 모든 섹션 숨기기
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.remove('active');
            });
            
            // 모든 버튼 비활성화
            document.querySelectorAll('.cta-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 기본정보 섹션일 때 고객 정보 섹션도 함께 표시
            if (sectionId === 'basic') {
                const customerSection = document.getElementById('customer-section');
                if (customerSection) {
                    customerSection.classList.add('active');
                }
            }
            
            // 선택된 섹션 표시
            const targetSection = document.getElementById(sectionId + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // 선택된 버튼 활성화
            const targetButton = event.target;
            if (targetButton) {
                targetButton.classList.add('active');
            }
        }

        // 상세 정보 푸터박스 토글 함수
        function toggleDetailFooter(type) {
            const footer = document.getElementById('detail-footer');
            const title = document.getElementById('detail-title');
            const content = document.getElementById('detail-content');
            
            if (type === 'auction') {
                title.textContent = '경매 시나리오 분석';
                content.innerHTML = `
                    <div class="auction-scenario">
                        <div class="scenario-item">
                            <div class="scenario-label">예상낙찰금</div>
                            <div class="scenario-bar safe"></div>
                            <div class="scenario-amount amount-safe">1억 8,000만원</div>
                        </div>
                        <div class="scenario-item">
                            <div class="scenario-label">근저당권</div>
                            <div class="scenario-bar safe"></div>
                            <div class="scenario-amount amount-safe">5,500만원</div>
                        </div>
                        <div class="scenario-item">
                            <div class="scenario-label">전세권</div>
                            <div class="scenario-bar safe"></div>
                            <div class="scenario-amount amount-safe">최대 7,590만원</div>
                        </div>
                    </div>
                    
                    <div class="loss-analysis">
                        <div class="loss-item">
                            <div class="loss-label">보증금 회수 가능 금액</div>
                            <div class="loss-amount safe">최대 4,910만원</div>
                        </div>
                        <div class="loss-item">
                            <div class="loss-label">손실 가능 금액</div>
                            <div class="loss-amount danger">최소 1,910만원</div>
                        </div>
                        <div class="loss-item">
                            <div class="loss-label">손실 확률</div>
                            <div class="loss-amount warning">약 30%</div>
                        </div>
                    </div>
                    
                    <div class="auction-details">
                        <div class="detail-section">
                            <h4 class="detail-section-title">경매 시나리오 분석</h4>
                            <div class="scenario-analysis">
                                <div class="analysis-item">
                                    <div class="analysis-title">💰 예상 낙찰가 분석</div>
                                    <div class="analysis-desc">현재 시세 기준 1억 8,000만원으로 예상되며, 이는 보증금 3억원의 60% 수준입니다.</div>
                                </div>
                                <div class="analysis-item">
                                    <div class="analysis-title">⚠️ 선순위 채권 분석</div>
                                    <div class="analysis-desc">근저당권 5,500만원, 전세권 최대 7,590만원으로 총 1억 3,090만원이 우선 변제됩니다.</div>
                                </div>
                                <div class="analysis-item">
                                    <div class="analysis-title">📊 보증금 회수 가능성</div>
                                    <div class="analysis-desc">낙찰금에서 근저당권과 전세권을 제외하면 최대 4,910만원만 회수 가능합니다.</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4 class="detail-section-title">손실 위험 분석</h4>
                            <div class="risk-analysis">
                                <div class="risk-item">
                                    <div class="risk-title">💸 최소 손실 금액</div>
                                    <div class="risk-desc">보증금 3억원 - 회수 가능 4,910만원 = 1,910만원 손실 (근저당권, 전세권 우선 변제 후)</div>
                                    <div class="risk-probability">발생 확률: 약 30%</div>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">📉 최대 손실 금액</div>
                                    <div class="risk-desc">낙찰가가 더 낮아질 경우 최대 2억원 이상 손실 가능</div>
                                    <div class="risk-probability">발생 확률: 약 10%</div>
                                </div>
                                <div class="risk-item">
                                    <div class="risk-title">✅ 무손실 가능성</div>
                                    <div class="risk-desc">낙찰가가 높아지거나 근저당권, 전세권이 적을 경우</div>
                                    <div class="risk-probability">발생 확률: 약 60%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4 class="detail-section-title">대응 방안</h4>
                            <div class="response-measures">
                                <div class="measure-item">
                                    <div class="measure-title">🛡️ 임대차보증금 반환보증보험</div>
                                    <div class="measure-desc">월 3만원으로 최대 3억원까지 보장받을 수 있습니다.</div>
                                </div>
                                <div class="measure-item">
                                    <div class="measure-title">📋 등기부등본 사전 확인</div>
                                    <div class="measure-desc">근저당권, 전세권 등 선순위 채권 현황을 미리 파악하여 위험도를 평가하세요.</div>
                                </div>
                                <div class="measure-item">
                                    <div class="measure-title">💰 대비 자금 확보</div>
                                    <div class="measure-desc">경매 발생 시 대비할 수 있는 자금을 미리 준비하세요.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (type === 'contact') {
                title.textContent = '집주인 연락 두절 상황';
                content.innerHTML = `
                    <div class="scenario-analysis">
                        <div class="analysis-item">
                            <div class="analysis-title">📞 연락 두절 원인 분석</div>
                            <div class="analysis-desc">집주인이 갑자기 연락이 안 되는 경우, 여러 가지 원인이 있을 수 있습니다.</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">⚠️ 가능한 위험 상황</div>
                            <div class="analysis-desc">• 부채 문제로 도피 중<br>• 다른 임차인과 분쟁 중<br>• 부동산 중복 매도 시도</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">✅ 대응 방안</div>
                            <div class="analysis-desc">• 등기부등본 확인으로 소유권 상태 점검<br>• 부동산 중개업소를 통한 확인<br>• 법적 조치 준비</div>
                        </div>
                    </div>
                `;
            } else if (type === 'price') {
                title.textContent = '저렴한 매물 위험 분석';
                content.innerHTML = `
                    <div class="scenario-analysis">
                        <div class="analysis-item">
                            <div class="analysis-title">💰 시세 대비 저렴한 이유</div>
                            <div class="analysis-desc">시세보다 20% 이상 저렴한 매물은 반드시 이유가 있습니다.</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">⚠️ 주의해야 할 사항</div>
                            <div class="analysis-desc">• 불법 증축 또는 용도 위반<br>• 집주인 재정 문제로 급매<br>• 주변 환경 악화 (소음, 악취 등)</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">✅ 확인 방법</div>
                            <div class="analysis-desc">• 등기부등본으로 건물 상태 확인<br>• 주변 시세와 정확한 비교<br>• 집주인 재정 상태 조사</div>
                        </div>
                    </div>
                `;
            } else if (type === 'contract') {
                title.textContent = '계약서 이상 조항 분석';
                content.innerHTML = `
                    <div class="scenario-analysis">
                        <div class="analysis-item">
                            <div class="analysis-title">📋 일반적이지 않은 조항들</div>
                            <div class="analysis-desc">표준 계약서에 없는 이상한 조건들이 포함된 경우를 분석합니다.</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">⚠️ 위험한 조항 예시</div>
                            <div class="analysis-desc">• 보증금 반환 조건이 모호한 경우<br>• 수리비 부담을 임차인이 지는 조항<br>• 계약 해지 시 과도한 위약금</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">✅ 대응 방안</div>
                            <div class="analysis-desc">• 법무법인 상담을 통한 조항 검토<br>• 표준 계약서와 비교 분석<br>• 불리한 조항 삭제 요구</div>
                        </div>
                    </div>
                `;
            } else if (type === 'credit') {
                title.textContent = '집주인 신용도 문제';
                content.innerHTML = `
                    <div class="scenario-analysis">
                        <div class="analysis-item">
                            <div class="analysis-title">💳 집주인 재정 상태 분석</div>
                            <div class="analysis-desc">집주인의 부채 현황과 신용도를 종합적으로 분석합니다.</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">⚠️ 위험 신호</div>
                            <div class="analysis-desc">• 다중 부채로 인한 압류 위험<br>• 신용불량자 등록<br>• 다른 부동산 경매 진행 중</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">✅ 보호 방안</div>
                            <div class="analysis-desc">• 임대차보증금 반환보증보험 가입<br>• 등기부등본 정기 확인<br>• 대항력 확보를 위한 실제 거주</div>
                        </div>
                    </div>
                `;
            } else if (type === 'fraud') {
                title.textContent = '전세사기 유형별 분석';
                content.innerHTML = `
                    <div class="scenario-analysis">
                        <div class="analysis-item">
                            <div class="analysis-title">🏠 중복 임대 사기</div>
                            <div class="analysis-desc">같은 집을 여러 명에게 임대하고 보증금만 받고 도피하는 사기</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">💰 가짜 소유자 사기</div>
                            <div class="analysis-desc">실제 소유자가 아닌 사람이 집을 임대하고 보증금을 받는 사기</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">📋 불법 증축 숨김</div>
                            <div class="analysis-desc">불법 증축된 부분을 숨기고 계약 후 철거 요구하는 사기</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-title">⚖️ 용도 위반 숨김</div>
                            <div class="analysis-desc">상업용 건물을 주거용으로 위장하여 임대하는 사기</div>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4 class="detail-section-title">검토해야 할 사항들</h4>
                        <div class="response-measures">
                            <div class="measure-item">
                                <div class="measure-title">📋 등기부등본 확인</div>
                                <div class="measure-desc">소유자 확인, 근저당권, 전세권 등 모든 권리 관계 점검</div>
                            </div>
                            <div class="measure-item">
                                <div class="measure-title">🏠 건물 상태 확인</div>
                                <div class="measure-desc">불법 증축, 용도 위반, 안전진단 이력 등 건물 상태 점검</div>
                            </div>
                            <div class="measure-item">
                                <div class="measure-title">👤 집주인 신원 확인</div>
                                <div class="measure-desc">신분증 확인, 연락처 검증, 다른 부동산 거래 이력 조사</div>
                            </div>
                            <div class="measure-item">
                                <div class="measure-title">💰 시세 비교 분석</div>
                                <div class="measure-desc">주변 시세와 비교하여 비정상적으로 저렴한지 확인</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            footer.classList.add('active');
        }

        // 상세 정보 푸터박스 닫기 함수
        function closeDetailFooter() {
            const footer = document.getElementById('detail-footer');
            footer.classList.remove('active');
        }

        // 배경 클릭으로 모달 닫기
        document.addEventListener('click', function(event) {
            const footer = document.getElementById('detail-footer');
            if (footer && footer.classList.contains('active')) {
                // 모달 배경(오버레이) 클릭 시 닫기
                if (event.target === footer) {
                    closeDetailFooter();
                }
            }
        });

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeDetailFooter();
            }
        });

        /**
         * ========================================
         * 페이지 로드 시 자동 데이터 로드
         * ========================================
         * 
         * 페이지가 로드될 때 localStorage에 저장된 이전 데이터를 자동으로 불러와서
         * 보고서에 적용합니다. 저장된 데이터가 없으면 기본 데이터를 사용합니다.
         */
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 보고서 페이지가 로드되었습니다.');
            
            // localStorage에서 저장된 데이터 불러오기
            const savedData = loadReportDataFromStorage();
            
            // 불러온 데이터로 보고서 설정 (저장된 데이터가 있으면 사용, 없으면 기본값 사용)
            setReportData(savedData);
            
            console.log('✅ 보고서 초기화가 완료되었습니다.');
        });

    </script>
</body>
</html>
